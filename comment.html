<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>إضافة تعليق</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .comment { border: 1px solid #ddd; padding: 10px; border-radius: 6px; margin-bottom: 10px; background: #fafafa; }
    .meta { font-size: 0.9em; color: #555; margin-bottom: 6px; }
  </style>
</head>
<body>
  <header>
    <h1>إضافة تعليق</h1>
    <nav>
      <a href="index.html">الرئيسية</a>
      <a href="about.html">عن الموقع</a>
      <a href="contact.html">اتصل بنا</a>
      <a href="comment.html">إضافة تعليق</a>
    </nav>
  </header>

  <main>
    <section>
      <h2>اكتب تعليقك</h2>
      <form id="commentForm">
        <label for="cname">الاسم:</label>
        <input type="text" id="cname" name="cname" required />

        <label for="ctext">التعليق:</label>
        <textarea id="ctext" name="ctext" rows="4" required></textarea>

        <button type="submit">إضافة</button>
      </form>
    </section>

    <section>
      <h2>التعليقات</h2>
      <div id="commentsList"></div>
    </section>
  </main>

  <footer>
    <small>© 2025 جميع الحقوق محفوظة</small>
  </footer>

  <script>
    const listEl = document.getElementById('commentsList');
    const formEl = document.getElementById('commentForm');
    const KEY = 'mySite.comments';

    function loadComments() {
      const raw = localStorage.getItem(KEY);
      const comments = raw ? JSON.parse(raw) : [];
      listEl.innerHTML = '';
      if (comments.length === 0) {
        listEl.innerHTML = '<p>لا توجد تعليقات بعد.</p>';
        return;
      }
      comments.forEach(c => {
        const div = document.createElement('div');
        div.className = 'comment';
        div.innerHTML = `
          <div class="meta">بقلم: ${escapeHTML(c.name)} — ${new Date(c.time).toLocaleString('ar-EG')}</div>
          <div>${escapeHTML(c.text)}</div>
        `;
        listEl.appendChild(div);
      });
    }

    function saveComment(name, text) {
      const raw = localStorage.getItem(KEY);
      const comments = raw ? JSON.parse(raw) : [];
      comments.unshift({ name, text, time: Date.now() }); // أحدث تعليق أولًا
      localStorage.setItem(KEY, JSON.stringify(comments));
    }

    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, s => ({
        '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
      })[s]);
    }

    formEl.addEventListener('submit', e => {
      e.preventDefault();
      const name = document.getElementById('cname').value.trim();
      const text = document.getElementById('ctext').value.trim();
      if (!name || !text) return;
      saveComment(name, text);
      formEl.reset();
      loadComments();
    });

    loadComments();
  </script>
</body>
</html>